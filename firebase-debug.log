[debug] [2025-11-11T23:18:17.561Z] ----------------------------------------------------------------------
[debug] [2025-11-11T23:18:17.564Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\Karim Mamdouh\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only functions --force
[debug] [2025-11-11T23:18:17.565Z] CLI Version:   14.24.2
[debug] [2025-11-11T23:18:17.565Z] Platform:      win32
[debug] [2025-11-11T23:18:17.565Z] Node Version:  v22.14.0
[debug] [2025-11-11T23:18:17.565Z] Time:          Wed Nov 12 2025 01:18:17 GMT+0200 (Eastern European Standard Time)
[debug] [2025-11-11T23:18:17.565Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-11-11T23:18:17.766Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-11-11T23:18:17.767Z] > authorizing via signed-in user (karimamdou7@gmail.com)
[debug] [2025-11-11T23:18:17.767Z] [iam] checking project rentat-app for permissions ["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]
[debug] [2025-11-11T23:18:17.768Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:17.768Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:17.769Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app:testIamPermissions [none]
[debug] [2025-11-11T23:18:17.769Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app:testIamPermissions x-goog-quota-user=projects/rentat-app
[debug] [2025-11-11T23:18:17.769Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app:testIamPermissions {"permissions":["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]}
[debug] [2025-11-11T23:18:18.594Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app:testIamPermissions 200
[debug] [2025-11-11T23:18:18.595Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app:testIamPermissions {"permissions":["cloudfunctions.functions.create","cloudfunctions.functions.delete","cloudfunctions.functions.get","cloudfunctions.functions.list","cloudfunctions.functions.update","cloudfunctions.operations.get","firebase.projects.get"]}
[debug] [2025-11-11T23:18:18.595Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:18.595Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:18.595Z] >>> [apiv2][query] POST https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions [none]
[debug] [2025-11-11T23:18:18.595Z] >>> [apiv2][body] POST https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions {"permissions":["iam.serviceAccounts.actAs"]}
[debug] [2025-11-11T23:18:19.478Z] <<< [apiv2][status] POST https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions 404
[debug] [2025-11-11T23:18:19.478Z] <<< [apiv2][body] POST https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions {"error":{"code":404,"message":"Unknown service account","status":"NOT_FOUND"}}
[debug] [2025-11-11T23:18:19.479Z] [functions] service account IAM check errored, deploy may fail: Request to https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions had HTTP Error: 404, Unknown service account {"name":"FirebaseError","children":[],"context":{"body":{"error":{"code":404,"message":"Unknown service account","status":"NOT_FOUND"}},"response":{"statusCode":404}},"exit":1,"message":"Request to https://iam.googleapis.com/v1/projects/rentat-app/serviceAccounts/rentat-app@appspot.gserviceaccount.com:testIamPermissions had HTTP Error: 404, Unknown service account","status":404}
[info] 
[info] === Deploying to 'rentat-app'...
[info] 
[info] i  deploying functions 
[info] Running command: npm --prefix "$RESOURCE_DIR" run build
[info] +  functions: Finished running predeploy script. 
[debug] [2025-11-11T23:18:22.918Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:22.918Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:22.918Z] >>> [apiv2][query] GET https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app [none]
[debug] [2025-11-11T23:18:23.138Z] <<< [apiv2][status] GET https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app 200
[debug] [2025-11-11T23:18:23.138Z] <<< [apiv2][body] GET https://cloudresourcemanager.googleapis.com/v1/projects/rentat-app {"projectNumber":"124866170143","projectId":"rentat-app","lifecycleState":"ACTIVE","name":"Rentat","labels":{"firebase":"enabled","firebase-core":"disabled"},"createTime":"2025-11-06T13:43:26.943560Z"}
[info] i  functions: preparing codebase default for deployment 
[info] i  functions: preparing codebase rentat for deployment 
[info] i  functions: ensuring required API cloudfunctions.googleapis.com is enabled... 
[info] i  functions: ensuring required API cloudbuild.googleapis.com is enabled... 
[info] i  artifactregistry: ensuring required API artifactregistry.googleapis.com is enabled... 
[debug] [2025-11-11T23:18:23.142Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:23.142Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:23.142Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/rentat-app/adminSdkConfig [none]
[debug] [2025-11-11T23:18:23.704Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/rentat-app/adminSdkConfig 200
[debug] [2025-11-11T23:18:23.704Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/rentat-app/adminSdkConfig {"projectId":"rentat-app","storageBucket":"rentat-app.firebasestorage.app"}
[debug] [2025-11-11T23:18:23.704Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:23.704Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:23.705Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs [none]
[debug] [2025-11-11T23:18:24.137Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs 200
[debug] [2025-11-11T23:18:24.138Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs {"configs":[{"name":"projects/rentat-app/configs/paymob"}]}
[debug] [2025-11-11T23:18:24.138Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.138Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.138Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables [none]
[debug] [2025-11-11T23:18:24.883Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables 200
[debug] [2025-11-11T23:18:24.883Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables {"variables":[{"name":"projects/rentat-app/configs/paymob/variables/secret_key","updateTime":"2025-11-11T18:24:05.011519126Z"},{"name":"projects/rentat-app/configs/paymob/variables/api_key","updateTime":"2025-11-11T18:24:04.119620346Z"},{"name":"projects/rentat-app/configs/paymob/variables/hmac_secret","updateTime":"2025-11-11T18:24:03.370345798Z"},{"name":"projects/rentat-app/configs/paymob/variables/integration_id","updateTime":"2025-11-11T18:24:04.050435937Z"}]}
[debug] [2025-11-11T23:18:24.884Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.884Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.884Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.884Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.884Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.885Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.885Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.885Z] Checked if tokens are valid: true, expires at: 1762905401205
[debug] [2025-11-11T23:18:24.885Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/secret_key [none]
[debug] [2025-11-11T23:18:24.886Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/api_key [none]
[debug] [2025-11-11T23:18:24.888Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/hmac_secret [none]
[debug] [2025-11-11T23:18:24.891Z] >>> [apiv2][query] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/integration_id [none]
[debug] [2025-11-11T23:18:25.106Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/secret_key 200
[debug] [2025-11-11T23:18:25.106Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/secret_key {"name":"projects/rentat-app/configs/paymob/variables/secret_key","updateTime":"2025-11-11T18:24:05.011519126Z","text":"egy_sk_test_f4544ea67865154cbc1be5f17a257bd53c768d429b768064fcef03e667ae5777"}
[debug] [2025-11-11T23:18:25.218Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/hmac_secret 200
[debug] [2025-11-11T23:18:25.219Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/hmac_secret {"name":"projects/rentat-app/configs/paymob/variables/hmac_secret","updateTime":"2025-11-11T18:24:03.370345798Z","text":"CCABDAA0D728DD9BDDC0C37A2F0584CF"}
[debug] [2025-11-11T23:18:25.719Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/api_key 200
[debug] [2025-11-11T23:18:25.720Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/api_key {"name":"projects/rentat-app/configs/paymob/variables/api_key","updateTime":"2025-11-11T18:24:04.119620346Z","text":"ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmpiR0Z6Y3lJNklrMWxjbU5vWVc1MElpd2ljSEp2Wm1sc1pWOXdheUk2TVRBNU5qVTFOaXdpYm1GdFpTSTZJbWx1YVhScFlXd2lmUS5xbTZsd2RYdDhRRjZaY2pfRHhJWWlDbXd0alZzcjNjOW5ZOTEzdTJGVWZ2TnJ1NDA4YWNzclhnRm5nX0ZrUlNfM0Z1VFhtaHJ0YTM3QmFldExWZXFqQQ=="}
[debug] [2025-11-11T23:18:25.720Z] <<< [apiv2][status] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/integration_id 200
[debug] [2025-11-11T23:18:25.720Z] <<< [apiv2][body] GET https://runtimeconfig.googleapis.com/v1beta1/projects/rentat-app/configs/paymob/variables/integration_id {"name":"projects/rentat-app/configs/paymob/variables/integration_id","updateTime":"2025-11-11T18:24:04.050435937Z","text":"5369141"}
[debug] [2025-11-11T23:18:25.722Z] Validating nodejs source
[debug] [2025-11-11T23:18:26.791Z] > [functions] package.json contents: {
  "name": "rentat-functions",
  "version": "1.0.0",
  "description": "Cloud Functions for Rentat/Rent@ application",
  "main": "lib/index.js",
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "npm run build && firebase deploy --only functions",
    "logs": "firebase functions:log",
    "lint": "eslint src --ext .ts,.js",
    "lint:fix": "eslint src --ext .ts,.js --fix"
  },
  "engines": {
    "node": "20"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "crypto": "^1.0.1",
    "express": "^4.18.2",
    "firebase-admin": "^12.0.0",
    "firebase-functions": "^7.0.0",
    "joi": "^17.11.0",
    "nodemailer": "^6.9.8",
    "stripe": "^14.9.0",
    "twilio": "^4.19.3",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.6",
    "@types/nodemailer": "^6.4.14",
    "@types/uuid": "^9.0.7",
    "@typescript-eslint/eslint-plugin": "^6.17.0",
    "@typescript-eslint/parser": "^6.17.0",
    "eslint": "^8.56.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-11-11T23:18:26.791Z] Building nodejs source
[info] i  functions: Loading and analyzing source code for codebase default to determine what to deploy 
[debug] [2025-11-11T23:18:26.793Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-11-11T23:18:26.808Z] Found firebase-functions binary at 'C:\Users\Karim Mamdouh\rentat\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8877

[debug] [2025-11-11T23:18:27.689Z] Got response from /__/functions.yaml {"endpoints":{"webhooks":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"webhooks"},"processRentalRequest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"processRentalRequest"},"processRentalResponse":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"processRentalResponse"},"completeRental":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"completeRental"},"onRentalCreated":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.created","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"rentals/{rentalId}"},"retry":false},"entryPoint":"onRentalCreated"},"onRentalUpdated":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"rentals/{rentalId}"},"retry":false},"entryPoint":"onRentalUpdated"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{}}
